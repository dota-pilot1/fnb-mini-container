================================================================
실무 백엔드(Spring Boot + MyBatis) 이해를 위한 핵심 30가지
================================================================

================================================================
성능 최적화 (26~30)
================================================================

26. N+1 문제
----------------------------------------------------------------
  - 1번 조회 후 결과 N건에 대해 N번 추가 쿼리가 실행되는 문제
  - MyBatis에서는 resultMap의 <collection> 사용 시 주의
  - 해결책:
      JOIN으로 한 번에 조회
      또는 IN 절로 한 번에 조회 (배치 로딩)
  - 관리자 목록 조회에서 자주 발생

  핵심 질문:
    "N+1이 왜 문제인지 쿼리 실행 수로 설명하면?"


27. DB 인덱스 기초
----------------------------------------------------------------
  - 인덱스 없는 컬럼을 WHERE 조건으로 쓰면 Full Table Scan
  - 자주 조회하는 컬럼(매장코드, 정산일자, 사용자ID)에 인덱스 추가
  - 복합 인덱스: 순서가 중요 (선두 컬럼부터 사용)
  - 인덱스가 너무 많으면 INSERT/UPDATE 성능 저하
  - EXPLAIN으로 실행 계획 확인

  핵심 질문:
    "인덱스가 있어도 쿼리가 느린 경우는 어떤 상황인가?"


28. 캐싱 (@Cacheable)
----------------------------------------------------------------
  - 자주 조회되고 잘 안 바뀌는 데이터를 메모리에 저장
  - @EnableCaching + @Cacheable("menuList")
  - @CacheEvict: 데이터 변경 시 캐시 삭제
  - 현업 활용: 메뉴 목록은 로그인 때마다 DB 조회 → 캐싱 적합
  - 주의: 캐시된 데이터와 DB 데이터 불일치 (Cache Staleness)

  핵심 질문:
    "@Cacheable과 @CacheEvict를 함께 쓰지 않으면 어떤 문제가 생기는가?"


29. 커넥션 풀 튜닝 + 슬로우 쿼리 대응
----------------------------------------------------------------
  - hikari.maximum-pool-size: CPU 코어 수 * 2 + 유효 디스크 수가 일반적 기준
  - 슬로우 쿼리 로그 설정:
      logging.level.org.mybatis: DEBUG → SQL + 실행 시간 확인
  - 오래 걸리는 쿼리 원인:
      인덱스 누락, N+1, 불필요한 전체 조회, 정렬 없는 페이징
  - 외부 API 호출을 트랜잭션 안에 두면 커넥션 점유 시간 급증
    (현업 SAP 5분 타임아웃 문제와 직결)

  핵심 질문:
    "커넥션 풀 사이즈를 무작정 크게 늘리면 안 되는 이유는?"


30. 페이징 성능 — OFFSET 방식의 한계와 대안
----------------------------------------------------------------
  - OFFSET이 크면 DB가 앞 데이터를 전부 읽고 버림 → 뒤 페이지일수록 느림
  - 해결책: 커서 기반 페이징 (No-Offset)
      WHERE id < #{lastId} ORDER BY id DESC LIMIT #{size}
      → 마지막으로 읽은 ID 기준으로 다음 페이지 조회
  - 관리자 페이지처럼 페이지 번호 직접 이동이 필요하면 OFFSET 불가피
  - 데이터 건수가 수만 건 이상이면 커서 기반 고려

  핵심 질문:
    "커서 기반 페이징은 특정 페이지 번호로 바로 이동이 왜 어려운가?"

================================================================
